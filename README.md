# Free Fly Bot

Дискорд бот для отслеживания событий и пилотов.

## Минимум работ

Бот должен отслеживать время до ближайшего события, параллельно принимать команды о создании удалении или изменения новых.

### Что нужно еще сделать

- [x] events, delevent: добавить фильтр на выдачу пользователю только тех событий к которому он имеет допуск. Копатель не должнен **видеть** и **создавать** события для производственников
- [x] переделать датаклассы в обычные классы с проверкой при присваивание значений
- [x] создать ui на команду add_event
- [x] перенести логику из команды test в add_event, добавление события в базу данных
- [x] добавить обработку ошибки add event modal
- [x] закрывать взаимодействие modal on_conferm
- [x] закрывать взаимодействие modal on_timeout
- [x] отслеживать нажатие на кнопку только от пользователя
- [x] написать парсер аргументов полученных от event_modal: event_date и event_time в datetime
- [x] таймер для отслеживания ближайшего события
- [x] sql создание таблицы on_join on_join_action
- [x] sql работа с событием на присоединение
- [x] sql новые классы onjoin и on_join_action
- [x] создать привественное сообщение с выбором кнопок
- [x] создать модальное окно под кнопку
- [x] sql добавить серверу тип "оплаченный" bool отвечает за оплаченный ли сервер дискорда или кто-то на халяву пользуется
- [ ] убрать из onjoin_query датаклассы и перенести их в data_classes пересобрать их в нормальные классы с проверкой
- [x] addevent - на момент выбора пользователем типа события, нужно давать список из типов к которым он имеет допуск. Копатель не должен создавать пинги производственников.
- [x] добавить пользовательское создание и удаление событий onjoin и onjoin action
- [ ] добавить коскадное удаление сервера и всех связанных таблиц в sql
- [x] проверка на существование даты 31 февраля

### Команды

- /help
- /eventslist - список всех событий на текущем сервере
- /addevent - создать новое событие на текущем сервере
- /deleteevent - удалить событие на текущем сервере

- /types - типы евентов на сервере
- /addtype - добавить тип на сервер
- /deletetype - удалить тип на сервере
- /updatetype - изменить тип на сервере

### Таблицы SQL

#### Events

| COLUMN NAME | TYPE    | ADT         |
|------------|----------|-------------|
| event_id   | INTEGER  | PRIMARY KEY |
| server_id  | INTEGER  | NOT NULL    |
| event_name | TEXT     | NOT NULL    |
| type_id    | INTEGER  | NOT NULL    |
| comment    | TEXT     |             |
| event_time | DATETIME | NOT NULL    |

#### Types

| COLUMN NAME | TYPE    | ADT         |
|-----------|---------|-------------|
| type_id   | INTEGER | PRIMARY KEY |
| server_id | INTEGER | NOT NULL    |
| type_name | TEXT    | NOT NULL    |
| channel   | TEXT    | NOT NULL    |

#### Discord servers

| COLUMN NAME | TYPE    | ADT         |
|-------------|---------|-------------|
| server_id   | INTEGER | PRIMARY KEY |
| server_name | TEXT    | NOT NULL    |

### Реализация

Содержится 2 потока:

1) Поток обрабатывающий работу с пользователями
2) Потом с таймером отсчета

Бот на discord.py

База данных aiosqlite
